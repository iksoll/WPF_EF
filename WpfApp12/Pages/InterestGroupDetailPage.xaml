<Page x:Class="WpfApp12.Pages.InterestGroupDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:material="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="{Binding Group.Title}"
      Background="{DynamicResource MaterialDesignPaper}">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{Binding Group.Title}" FontSize="24" FontWeight="Medium" Margin="0,0,0,8"/>

        <TextBox Grid.Row="1" AcceptsReturn="True" TextWrapping="Wrap"
                 Text="{Binding Group.Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Visibility="{Binding IsEditing}"/>
        <TextBlock Grid.Row="1" Text="{Binding Group.Description}" Foreground="Gray" TextWrapping="Wrap"
                   Visibility="{Binding IsEditing}"/>

        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,8,0,16"
                    Visibility="{Binding IsEditing}">
            <Button Content="Сохранить" Click="Save_Click" Style="{StaticResource MaterialDesignRaisedButton}" Margin="0,0,8,0"/>
            <Button Content="Отмена" Click="Cancel_Click" Style="{StaticResource MaterialDesignFlatButton}"/>
        </StackPanel>

        <TextBlock Grid.Row="3" Text="Участники:" FontWeight="Bold" Margin="0,0,0,8"/>

        <ListView Grid.Row="4" ItemsSource="{Binding Group.UserGroups}" Margin="0,8,0,0">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal" Margin="0,4">
                        <Ellipse Width="24" Height="24" Fill="LightGray" Margin="0,0,8,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding User.UserProfile.AvatarUrl}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding User.UserProfile.AvatarUrl}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>

                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding User.Login}" FontWeight="Bold"/>
                                <TextBlock Text=" (" Foreground="Gray"/>
                                <TextBlock Text="{Binding User.Name}" Foreground="Gray"/>
                                <TextBlock Text=")" Foreground="Gray"/>

                                <TextBlock Text="[Модератор]" Foreground="Green" FontWeight="Bold" Margin="4,0,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsModerator}" Value="True">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                            <TextBlock Text="{Binding JoinedAt, StringFormat=Вступил: dd.MM.yyyy}"
                                       FontSize="12" Foreground="Gray"/>
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="Добавить участника" Click="AddMember_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}" Margin="0,0,8,0"/>
            <Button Content="Назад" Click="Back_Click" Style="{StaticResource MaterialDesignFlatButton}"/>
        </StackPanel>
    </Grid>
</Page>